<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Sherlock Consults By Inspecting the Data and Evaluating Conditional Effects — sherlock_calculate • sherlock</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Sherlock Consults By Inspecting the Data and Evaluating Conditional Effects — sherlock_calculate" />
<meta property="og:description" content="Sherlock Holmes was a consulting detective who had spectacular powers of
deduction and logical reasoning. Within sherlock's causal segmentation
framework, sherlock_calculate takes data from a segmentation &quot;case&quot;,
the roles of the different variables, and specifications for assessing the
conditional treatment effects required for deriving a segmentation. Being
the workhorse, this function is the most demanding, as it computes all of
the nuisance parameters required for subsequent analyses. The complementary
functions watson_segment and mycroft_assess can
be used once Sherlock has consulted on the causal segmentation case." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sherlock</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/sherlock_quick_start_netflix.html">`sherlock`: Causal Machine Learning for Segment Discovery</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sherlock Consults By Inspecting the Data and Evaluating Conditional Effects</h1>
    
    <div class="hidden name"><code>sherlock_calculate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Sherlock Holmes was a consulting detective who had spectacular powers of
deduction and logical reasoning. Within <span class="pkg">sherlock</span>'s causal segmentation
framework, <code>sherlock_calculate</code> takes data from a segmentation "case",
the roles of the different variables, and specifications for assessing the
conditional treatment effects required for deriving a segmentation. Being
the workhorse, this function is the most demanding, as it computes all of
the nuisance parameters required for subsequent analyses. The complementary
functions <code><a href='watson_segment.html'>watson_segment</a></code> and <code><a href='mycroft_assess.html'>mycroft_assess</a></code> can
be used once Sherlock has consulted on the causal segmentation case.</p>
    </div>

    <pre class="usage"><span class='fu'>sherlock_calculate</span><span class='op'>(</span><span class='va'>data_from_case</span>, <span class='va'>baseline</span>, <span class='va'>exposure</span>, <span class='va'>outcome</span>, <span class='va'>segment_by</span>,
  ids <span class='op'>=</span> <span class='cn'>NULL</span>, treatment_cost <span class='op'>=</span> <span class='cn'>NULL</span>, cv_folds <span class='op'>=</span> <span class='fl'>5L</span>,
  split_type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"inner"</span>, <span class='st'>"outer"</span><span class='op'>)</span>, <span class='va'>ps_learner</span>, <span class='va'>or_learner</span>, <span class='va'>cate_learner</span>,
  use_cv_selector <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_from_case</th>
      <td><p>Rectangular input data, whether a <code>data.frame</code>,
<code><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></code>, or <code><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></code>.</p></td>
    </tr>
    <tr>
      <th>baseline</th>
      <td><p>A <code>character</code> vector specifying the column names in
<code>data_obs</code> that correspond to the baseline covariates (conditioning
set). These variables should temporally precede the exposure and outcome.</p></td>
    </tr>
    <tr>
      <th>exposure</th>
      <td><p>A <code>character</code> string (of length one) specifying the
column in <code>data_obs</code> corresponding to the exposure or treatment. This
variable should follow those in <code>baseline</code> in time but precede the
response variable <code>outcome</code>.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>A <code>character</code> string (of length one) specifying the
column in <code>data_obs</code> corresponding to the response variable.</p></td>
    </tr>
    <tr>
      <th>segment_by</th>
      <td><p>A <code>character</code> vector specifying the column names in
<code>data_obs</code> that correspond to the covariates over which segmentation
should be performed. This should be a strict subset of <code>baseline</code>.</p></td>
    </tr>
    <tr>
      <th>ids</th>
      <td><p>A <code>character</code> string (of length one) specifying the column
in <code>data_obs</code> that gives observation-level IDs. The default value of
<code>NULL</code> assumes that all rows of <code>data_obs</code> are independent.</p></td>
    </tr>
    <tr>
      <th>treatment_cost</th>
      <td><p>A <code>character</code> string (of length one) specifying
the column in <code>data_obs</code> that provides the cost associated to treating
the given unit. The default value of <code>NULL</code> assumes that all units are
equally costly to treat.</p></td>
    </tr>
    <tr>
      <th>cv_folds</th>
      <td><p>A <code>numeric</code> specifying the number of cross-validation
folds to be used for sample-splitting when estimating nuisance parameters.</p></td>
    </tr>
    <tr>
      <th>split_type</th>
      <td><p>A <code>character</code> string (of length one) indicating the
sample-splitting "level" at which estimation of the CATE is performed. The
choices are "inner", for estimation of the CATE within folds (i.e., at the
the same level at which nuisance parameters are estimated), and "outer", in
which case the CATE is estimated at the "full-sample" level.</p></td>
    </tr>
    <tr>
      <th>ps_learner</th>
      <td><p>Either an instantiated learner object (class inheriting
from <code><a href='https://tlverse.org/sl3/reference/Lrnr_base.html'>Lrnr_base</a></code>), from <span class="pkg">sl3</span>, or a <code>list</code> of
specifications, or a constant rate between 0 and 1, to be used for
estimation of the propensity score (the probability of receiving treatment,
conditional on covariates). If <code>list</code>: each entry may be an
instantiated learner object, or can be a list where one item is an
instantiated learner object whose modeling requires specification, and the
other item is a list of character vectors, where each vector specifies an
interaction term. If constant rate, this rate represents the population
probability of being assigned to treatment in an A/B tests. Note that the
outcome of this estimation task is strictly binary and that algorithms or
ensemble models should be set up accordingly.</p></td>
    </tr>
    <tr>
      <th>or_learner</th>
      <td><p>Either an instantiated learner object (class inheriting
from <code><a href='https://tlverse.org/sl3/reference/Lrnr_base.html'>Lrnr_base</a></code>), from <span class="pkg">sl3</span>, or a <code>list</code> of
specifications, to be used for estimation of the outcome regression (the
mean of the response variable, conditional on exposure and covariates). If
<code>list</code>: each entry can be an instantiated learner object, or can be a
list where one item is an instantiated learner object whose modeling
requires specification, and the other item is a list of character vectors,
where each vector specifies an interaction term.</p></td>
    </tr>
    <tr>
      <th>cate_learner</th>
      <td><p>Either an instantiated learner object (class inheriting
from <code><a href='https://tlverse.org/sl3/reference/Lrnr_base.html'>Lrnr_base</a></code>), from <span class="pkg">sl3</span>, or a <code>list</code> of
specifications, to be used to estimate the CATE, based on a regression of a
doubly robust pseudo-outcome on the specified segmentation covariates. If
<code>list</code>: each entry can be an instantiated learner object, or can be a
list where one item is an instantiated learner object whose modeling
requires specification, and the other item is a list of character vectors,
where each vector specifies an interaction term. Note that the outcome of
this estimation task is derived from the other nuisance parameter estimates
and should be expected to always be continuous-valued, so algorithms or
ensemble models should be set up accordingly.</p></td>
    </tr>
    <tr>
      <th>use_cv_selector</th>
      <td><p>If <code>TRUE</code>, then will use cross-validation to
choose the best among a list of learners when fitting <code>ps_learner</code>,
<code>or_learner</code> or <code>cate_learner</code>. If <code>FALSE</code> (default), then
the default metalearner for the outcome type (from <span class="pkg">sl3</span>) will be used.
This argument will not be ignored for a <code>learner</code> that is not a list,
but is instead an instantiated learner object.</p></td>
    </tr>
    </table>


  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nima Hejazi, Wenjing Zheng, Netflix, Inc..</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


